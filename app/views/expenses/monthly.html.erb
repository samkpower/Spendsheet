<% content_for :chartkick do %>
  <%= javascript_include_tag "//www.google.com/jsapi", "chartkick" %>
<% end %>

<div class="page-header">
  <h1><small>Monthly Summary</small></br>
    <div class="dropdown inline-block">
      <a href="#" class="dropdown-toggle title-link" data-toggle="dropdown"><%= @date.strftime("%B %Y") %>&nbsp<i class="icon-caret-down"></i></a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
          <div class="select-month">
            <%= form_tag("/expenses/monthly", method: "get") do %>
            <%= label_tag("Month") %>
            <%= select_month(Date.today) %>
            <%= label_tag("Year") %>
            <%= select_year(Date.today) %>
              <br>
            <%= submit_tag("Submit") %>
            <% end %>
          </div>
        </ul>
    </div>
    <div class="pull-right">
      <%= link_to "Create a New Entry", new_expense_path, :class => "btn btn-primary btn-large" %>
    </div>
  </h1>
</div>

<ul class="nav nav-tabs">
  <li class="active"><a href="#date" data-toggle="tab">Organized by Date</a></li>
  <li><a href="#category" data-toggle="tab">Organized by Category</a></li>
</ul>


<div class="tab-content">
  <div class="tab-pane active" id="date">
    <%= line_chart @monthly_expenses.select("month(created_at)").group("date(created_at)").sum("amount") %>
    <table class = "table">
    	<thead>
        <tr>
          <th class = "span2">Date</th>
          <th class = "span7">Category</th>
          <th>Amount</th>
          <th class = "span1"></th>
        </tr>
    	</thead>
    	<tbody>
      <%= render partial: "expense", collection: @sorted_monthly_expenses, as: :expense %>
      <tr class = "info">
        <td class = "span2"><h4>Total</h4></td>
        <td class = "span8"></td>
        <td><h4><%= number_to_currency(Expense.sum_expenses(@sorted_monthly_expenses)) %></h4></td>
        <td></td>
      </tbody>
    </table>
  </div>

  <div class="tab-pane" id="category">
    <%= pie_chart @monthly_expenses.group("category").select("category.name").sum("amount")
%>
    <table class = "table">
      <thead>
        <tr>
          <th class = "span10"><strong>Category</strong></th>
          <th class = "span2"><strong>Amount</strong></th>
        </tr>
      </thead>
      <tbody>
        <% @monthly_expenses.group_by_category.each do |category, amount| %>
          <tr>
            <td><%= category.name %></td>
            <td><%= number_to_currency(amount) %></td>
          </tr>
        <% end %>
      <tr class = "info">
        <td class = "span10"><h4>Total</h4></td>
        <td class = "span2"><h4><%= number_to_currency(Expense.sum_expenses(@monthly_expenses)) %></h4></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>